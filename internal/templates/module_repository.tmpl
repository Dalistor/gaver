package repositories

import (
	"{{.ProjectName}}/config/database"
	"{{.ProjectName}}/modules/{{.ModuleName}}/models"
	"fmt"
)

type {{.ModelName}}Repository struct{}

func New{{.ModelName}}Repository() *{{.ModelName}}Repository {
	return &{{.ModelName}}Repository{}
}

{{if .HasList}}
// FindAll retorna todos os {{.ModelNameLower}}s
func (r *{{.ModelName}}Repository) FindAll() ([]models.{{.ModelName}}, error) {
	var items []models.{{.ModelName}}
	result := database.DB.Find(&items)
	return items, result.Error
}
{{end}}

{{if .HasGet}}
// FindByID retorna um {{.ModelNameLower}} por ID
func (r *{{.ModelName}}Repository) FindByID(id string) (models.{{.ModelName}}, error) {
	var item models.{{.ModelName}}
	result := database.DB.First(&item, id)
	return item, result.Error
}
{{end}}

{{if .HasCreate}}
// Create cria um novo {{.ModelNameLower}}
func (r *{{.ModelName}}Repository) Create(data map[string]interface{}) (models.{{.ModelName}}, error) {
	var item models.{{.ModelName}}
	
	// Converter map para struct
	// TODO: Melhorar este processo de conversão
	result := database.DB.Model(&item).Create(data)
	if result.Error != nil {
		return item, result.Error
	}
	
	// Buscar o item criado para retornar completo
	database.DB.First(&item, item.ID)
	return item, nil
}
{{end}}

{{if .HasUpdate}}
// Update atualiza um {{.ModelNameLower}}
func (r *{{.ModelName}}Repository) Update(id string, data map[string]interface{}) (models.{{.ModelName}}, error) {
	var item models.{{.ModelName}}
	
	// Buscar item existente
	if err := database.DB.First(&item, id).Error; err != nil {
		return item, fmt.Errorf("{{.ModelNameLower}} não encontrado")
	}
	
	// Atualizar
	result := database.DB.Model(&item).Updates(data)
	if result.Error != nil {
		return item, result.Error
	}
	
	// Buscar item atualizado
	database.DB.First(&item, id)
	return item, nil
}
{{end}}

{{if .HasDelete}}
// Delete remove um {{.ModelNameLower}}
func (r *{{.ModelName}}Repository) Delete(id string) error {
	var item models.{{.ModelName}}
	
	// Verificar se existe
	if err := database.DB.First(&item, id).Error; err != nil {
		return fmt.Errorf("{{.ModelNameLower}} não encontrado")
	}
	
	// Deletar
	result := database.DB.Delete(&item)
	return result.Error
}
{{end}}

